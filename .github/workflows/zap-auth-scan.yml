name: ZAP Authenticated Scan (Cookie-Based + Hardcoded Cookies)

on:
  workflow_dispatch:
  push:
  pull_request:

jobs:
  zap-full-scan:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Fix workspace permissions
      run: chmod -R 777 .

    - name: Create output folder
      run: mkdir -p zap-output && chmod 777 zap-output

    - name: Run ZAP Full Authenticated Scan (VERBOSE + DEBUG LOGS)
      env:
        ZAP_AUTH_HEADER: Cookie
        ZAP_AUTH_HEADER_VALUE: .AspNetCore.Cookies=chunks-2; .AspNetCore.CookiesC1=CfDJ8PG0OfX_0HJHm8TZl0YhxGAuaIUK03ikoRz2lRyIQlFC29gRcepOvEqscApo51A5-5Z11cS6uD1fpgxtHQK9XXkGcJqO55HOZhloIu8PxpBqS8RA1p1x8ljhej-snzlK1-Ib-naWqr0rdeW1NpX9PfYtmZxofJnS3y7D4aj5je7Va9jZzKzkKhCkwbcyLnieiNUw20UDkzxLSYarAiEUfAj17OZuupLgetMO7XKitMNounKC_81tBfdFO3RY6bNx6jmgLuiBwuMKKQHwyGR5IyTbUsFWzUCg1r7glVkMhhZi1P7AFYa1_DswL0aqIuTMkHTPxNGgDEU28rK-BKZwU-lAG3HzDSG81F-Fu6OzXkGTeoia6jMuwgO6MNconF1M1tbtOpi-3RCV18XN_52NKHCY4nEN1UlJusB_XKWfMdOipbpCh4MY8sza9WfjG5IyOSHn6U_BnHnlG0onCcsARW8GBrx3Ppyjykj0XQGS9zo4aQLv36R_1fdxExIVFylQUFi40WqGJ6Oe-_pCGnF-LdwjWoemLqCK63hC0pFfDtLwvMBdGdI5lTfyIVqYmRM4MTZJYv_AwsBbmiBjAhEmxM-_9FaeJvQsKtIhYhA1zHoszaEM9n5jv794B22kstzUX0t9OiRIuPDk53ex0bf5b-BU_wKCOAWlev8CQY0UI6V23XeK1Rv_g3Jz_Gh92tokKbsObiZO9WxmSfW6B0m3ZNG3UTD5FbNeeRNS44tipxQsyxO0O3QXJoy3w1yfd7FVje68NKTVLd66zSOSV-Qew545tnZWJucdFR_8WZxtPasEmXCNr4eTuKhh1NHVMOhk1Cu-URHT8m-Jmh83ucM3v4pNZ4THZZ2AOlIUz11X-qzQ8ieAhGLurhJ_0qC8RHMMHUkeDaq81qE18jwZXIZtBtwOdccA8-gdlKWEceNATtRPsufgLdVqHEFUxRzdkFxXq0Zj4utu2_W8oPOI8A5GmynFy9tIfnbaXNNaV4zZcWh055Mdv8ZYbOC-gih1wp1hylTLK0GUkImofwaoZmcu2lDUxAyQXRAzZ5cdtnEwmgjIHhN_q4TV48jfkptl2ffScmFY_SuG0y8WlEA1fmRoMtjJbnHBb70VzxcO_8XL1Jt3FQWk91qT1MDJs60U5D1FbqXFgv25wtjKWpqrSwu-HbdDnoLbptAaXsxWhhWCP0mqQDyHjvHQhzLdggrhZZtpiuccub-TQqCq5kjUnkZCz2NwJ_GP0PiGF514syV5uOtPNBuDgubIPjjD82yOkuDfZVwmCDg6T0OKhAUiJ45NFZFDuDonFIwcmdLG1WMEBQ7T2Ti-E4B9pj-0qWfEDlZzmoH4LmqPhna7tyqtzwKGL1Ywhf3WfMn1sIwCxirYGVjT6lVLrnViorQ0dcZIZl7zfROnLSI2Vh7QPPphTqJSyB_4eyAaEm-QGqItkqTUVLmJ6bkR107ByQtkeNWKpJEE-V5I3ppPaojRKVoXVihDfd-f9KWLFhrvtADFxd6lJ_YJjGF5cFMQX2WxWPXmVswXb0GlSghgFpictc_1B_X2_j84-AP3-QT4xYGflk5-f1BoUVC9rl_saVDI8u0z4v9ES-4nU41oSff4sQ33olqJ1HGcsRivJ4sQv1fU5WMYL_SpZoxAKNopoWRjCKQU9WYrTIhlIZNcsGz0Ng4khzt043BaSsh99dUBEoShLtDk6Jz3OrIOE0ki4jR6m2oZMdodvPSmIx3L0in7TBVjuuVJUxT-sFBT1QV-wIDjAnDhxASrFvUXrgreICCP-xssPZH7arNxnDZ2N244NXd_-UHILEydlSVmFYcgFc543CBdq1L6ccdplOVPAO1pG7KNvMZ7bW4L2G8Fwnz5HBZYH8bC9Jtd3RXcmOmA5E4zjRm6BqP42OZonvDYNTeyjqfFGWnHEAaF4U3_uLA-9-E1gS7P3riajC_N-xa8ijdAU6wgfS1kelKKYuPJSim1WJ3WfvNtDrj_WKGUW1jRuUK5ildsFOiU9cGZb3CycaJZtjkIochM3BcGbxCvhgs1yz1CHMl7ZqTiKl6M1fCvqDx4-_78N2JI8ltrmPhDbaBIBK-1qG0OmQLqhF75R5dYtE9sk5F964Y-Q6h8xn9zbjRvoEy15Loy7_Yi4pwaYqsgkafJtaixUUf4IIQGBxP1gl4jYxe3iN482QO_cYn_QV6WWRcN5-biBXf-wuFrPNKN64s_zOL1NTIWgmdC7bFm6ft4jlRARIT5omaSrH9bXNRH_eNapjRcNDVkS24OJ7ZZLZIoCAGAibnzrXwt4cT-BgazO74Os8QRG-zdZyKaFpKrGTnATvHizka-4Dk9h8KwJ-i-wwV6n7IDBB-3utAqqb54iVo8dZ1jPkMfFtEYo5f8zYgc5Eut4AJRUUE1xAQJpb7qU0jF9-PcyqMIWym0o4WwLKjjB7vPO03A7OSk_579RRpSqbSrEGam_3WBfJUBL9agudkGNb0_61d3c9r5c3erXr9T5tOZqF4sRzZuER2iif4L1P7Iket85nwKQlfSdVBJG0qqgThWunedQqHnWFgiAKNkRays8FL9ypRBoM9oqYUylkqTlvkA24Vj8Ed4oLY2yBREJGYBmkM8zcz_voOtZn0aK3b6mwEi1Goo-byPelKxU8yt4El4Kn0wn2IDjvXLRnIQUlvvhfohKYND4gz_vnQZe0LfJSllmM6-3dzfxtIyvnBiJFA7fW-3STyWBySBitnXU_BvdMQPVI2QQR5Tb5S4ey7S8c_JB2PCEIxkU-tCKNZY0Z7zg2fhEdueJGF5XYqoYm1l0sxYQp-lSz4-DB_uodNC23rhcENQ0knfcp7PcEZzQ9N56S0IydHDal43ld-_4Njs5xN8cDNPL6Knyjh6rxiP9CKEWfxb53BQuoVRIZslzHeK4kCpnMeaHINdzCND7lSsRYLZI2n6Pg_6mjhHewvus9qDrn4HxOwm1PX99R0ITzkjcA8q0YUZHUUou9exZBgXHUSU2KmJiOkpgc-umKlCY9HexQkPKMPROVDrr8jPoYtTQx1qdffllY-jrmabo7LbkZoWBAV2Lfxr1EB1gxtZ5JFV6f6nbGpPtV9C3tVYKdn9lOxVxYCkk-enKE-acwqcVF39MuLCF_818uQ91AxkDU80K8t6AkbFIuqAGEtgwSeDTb6UkCyLNKvZ__hGK7sJIJjHCcI6--WbY-7GDAhshoMao8ZqxSm7mfLkPDSD15XsLcbHy3ioq7zr3Eu9zZHa1mUvrd3qxSMv2qX4kAz8zOqjOA-tnP1G3l674GcMRbGvDYAqVaetw_gbr0dWB_-zVjSZ8oU1j5eb2jH6V6_jdnz4PdN-Z8szzQ7eTu6i7zbjWjChUvZq1gtL_605ho4u_7Q2FqSrbVOcbnounALBzUj3xyyt8fWifBh3SQDlzY55rwi3TWrhSG4dqePeDkurPLHhxbSUk1qQLFC2JmabbbaeqBDkUXOm1-0XLsUzSJEFUC1yFQOxznhMwiKPqgU0AYlM7dg2JLUz5n3w-6Rxz4OywHrMxsmzGs9kxV4m7i8iMDUkN9ZOaXCe5USfZBxZ7_Qu-_EhsZcTboO7EO5PWJK0huZsmQhh8ortFzjx41kaMBq0qjhZDW_pIIbPfjnI9a-stxmheecrIAzfJUUMwRquvFLnO_yAUaINa-6LhSHf8u-ZVU4e0VZTJMvjr2fPYD-Sbnp3Or4YLZMi8rMUL7oewZLUp9UBFoMQ9hxZMWWh5uToHHMTPAsc7yInWi58xpyNn4WXiogh8fDO4h97LgOus8RxkFEGGqCY00LJFqb6lhIjV6gYNjCM4RYbN3v-jldRnY086NEOZXTGGt_mViEsgR7X1HEifU58cmbAyz9WopWBd_kE2A98dXFgwBDHOXTYSY3JpVk8tb38nOa6RLpD50kLLdmWUXmSEsNdvWwLXB01cV2fRuncEvbZA4L8iDe5PqyFjeTlcYom-xmqEDqVI3bvJl7; .AspNetCore.CookiesC2=wydgR0mjMraGhZGDT4abtiL4V7H806S8o_WHq1kpFaKdE7iVLzWPsoJoh2A4LTvW4YAie5dmV0M56TVLf8ItSMPqw1HN2yFh2aOeO8dnHSQD6sjjFGGfGv6n8w5eqhXb09a9RXKLF97CU7jhSiIVS5kS1T71ZNafQOAcqLwksDHs-WcJpDAVCfdV1NFhVMaos3Oi1NhVO21I8Pu_59Q3LuGCNnGuvqRPT9E1nXf3Ppow38iGqGReOyeXalcfDilH9xEAPont8v5VYPNJE-6vGYHCj1UAGs_Jm2QvoUh7A276kGoEJ6EK6SiM7gEJKG34CMIEhgTHJb5-7MR1ujYhczSyQAqd6ERuNHVbiFvKqL1EAC_rvaYnFK0c3q9802LXAVQQaPuS3ziBr59Imel40-fMer7c9I_w5FL0mZ0brnSFtNpzTNGKLJB_PLCfLFrHZSEYHTRnwo_2iydSDbjQsX6a7GVqboNlfzrwH9BGGCOCDrBbNNovzFy_vFFGpIL_5gxzHAJjf1paoAmENAHrIFzyYsVZO8R1zm3YTaiCbKlbal_zJ7lmZempI0A1Dd1KP_YY7P55c-SyxulkSL5HmY_9yCIkcZH1sJJtvbyWqrsZOPgqFPWcMowJqVS18j9A0zzaIpWlKdtehSrv6C3t-6Xd13DwdML62I3GI1qp_QxN-C246MjJQegUGJnOmEeymsDGRu9ioMNxyrTyEf6zmi9ReMI2LvcgaRlzU1tG_szgd0_ASsx0jfVrRamVkPUcwdcm1ztkyZ5u7a-Hjs7stq5YS6JoZh-ee300hMQjjQ3nL6visrXY9ePzaJ56js08okRaF30B23W1uHeUXy9sFtnN_AaKSXnLLd4cpJwf8gXFOKEfgqTZqX0aATa7nScC5tWUpv8fWhzY409C_mzMHfW2Zvzy5Ak3aPGvZx8UPhuRWYyCIqZXa90LKPSJP3u3OzsDOuNpKG90Sa7MvgYmIXnFqwjm-Yxgy1mwWArzDfxv2yfj0NGoXnGMBUZbC9dZciiSzeaSpDSsomia8c1Xwp8XD0o0XcoyY2JyIjz8aTdiAmp1wY37zESZlzpCXFHATgrQy4CM
      run: |
        docker run --rm \
          -v "$(pwd):/zap/wrk" \
          -e ZAP_AUTH_HEADER \
          -e ZAP_AUTH_HEADER_VALUE \
          ghcr.io/zaproxy/zaproxy:stable \
          zap-full-scan.py \
          -t https://valuelabs-admin.adhoc.stabilthus.io/dashboard \
          -g gen.conf \
          -r zap-report.html \
          -x zap-report.xml \
          -j \
          -I \
          -d

    - name: Upload ZAP HTML Report
      uses: actions/upload-artifact@v4
      with:
        name: zap-html-report
        path: zap-report.html

    - name: Upload ZAP XML Report
      uses: actions/upload-artifact@v4
      with:
        name: zap-xml-report
        path: zap-report.xml

    - name: Upload ZAP Debug Log
      uses: actions/upload-artifact@v4
      if: always()          # ‚Üê CORRECT SYNTAX
      with:
        name: zap-debug-log
        path: zap-debug.log
